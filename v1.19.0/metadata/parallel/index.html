<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parallel files · WriteVTK.jl</title><meta name="title" content="Parallel files · WriteVTK.jl"/><meta property="og:title" content="Parallel files · WriteVTK.jl"/><meta property="twitter:title" content="Parallel files · WriteVTK.jl"/><meta name="description" content="Documentation for WriteVTK.jl."/><meta property="og:description" content="Documentation for WriteVTK.jl."/><meta property="twitter:description" content="Documentation for WriteVTK.jl."/><meta property="og:url" content="https://juliavtk.github.io/WriteVTK.jl/metadata/parallel/"/><meta property="twitter:url" content="https://juliavtk.github.io/WriteVTK.jl/metadata/parallel/"/><link rel="canonical" href="https://juliavtk.github.io/WriteVTK.jl/metadata/parallel/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><script src="../../assets/tomate.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">WriteVTK.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Grid formats</span><ul><li><a class="tocitem" href="../../grids/syntax/">General syntax</a></li><li><a class="tocitem" href="../../grids/structured/">Structured grid formats</a></li><li><a class="tocitem" href="../../grids/unstructured/">Unstructured grid formats</a></li><li><a class="tocitem" href="../../grids/datasets/">Writing datasets</a></li></ul></li><li><span class="tocitem">Metadata formats</span><ul><li><a class="tocitem" href="../multiblock/">Multiblock files</a></li><li><a class="tocitem" href="../paraview_collections/">ParaView collections</a></li><li class="is-active"><a class="tocitem" href>Parallel files</a><ul class="internal"><li><a class="tocitem" href="#Generating-a-parallel-data-file"><span>Generating a parallel data file</span></a></li><li><a class="tocitem" href="#Parallel-structured-files"><span>Parallel structured files</span></a></li><li><a class="tocitem" href="#Example-1:-Unstructured-files"><span>Example 1: Unstructured files</span></a></li><li><a class="tocitem" href="#Example-2:-Structured-files"><span>Example 2: Structured files</span></a></li><li><a class="tocitem" href="#Acknowledgements"><span>Acknowledgements</span></a></li></ul></li></ul></li><li><span class="tocitem">Additional tools</span><ul><li><a class="tocitem" href="../../tools/surface/">Generating surface plots</a></li><li><a class="tocitem" href="../../tools/write_array/">Visualising Julia arrays</a></li><li><a class="tocitem" href="../../tools/readvtk/">Reading VTK files</a></li></ul></li><li><a class="tocitem" href="../../API/">API Reference</a></li><li><a class="tocitem" href="../../external/VTKBase/">VTKBase.jl</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Metadata formats</a></li><li class="is-active"><a href>Parallel files</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Parallel files</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaVTK/WriteVTK.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaVTK/WriteVTK.jl/blob/master/docs/src/metadata/parallel.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Parallel-files"><a class="docs-heading-anchor" href="#Parallel-files">Parallel files</a><a id="Parallel-files-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-files" title="Permalink"></a></h1><p>The parallel file formats do not actually store any data in the file. Instead, the data is broken into pieces, each of which is stored in a serial file, and an extra header file is created containing pointers to the corresponding serial files. The header file extension is the serial extension prepended with a <code>p</code>. For instance, for serial <code>vtu</code> files, the corresponding header file extension is <code>pvtu</code>.</p><h2 id="Generating-a-parallel-data-file"><a class="docs-heading-anchor" href="#Generating-a-parallel-data-file">Generating a parallel data file</a><a id="Generating-a-parallel-data-file-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-a-parallel-data-file" title="Permalink"></a></h2><p>The parallel header file and the corresponding serial files are generated by a single call to <a href="../../API/#WriteVTK.pvtk_grid-Tuple{AbstractString, Vararg{Any}}"><code>pvtk_grid</code></a>. Its signature is</p><pre><code class="language-julia hljs">pvtk_grid(
    filename, args...;
    part, nparts, ismain = (part == 1), ghost_level = 0, kwargs...,
)</code></pre><p>which returns a handler representing a parallel VTK file that can be appended with cell and point data and eventually written to disk with <a href="../../API/#WriteVTK.vtk_save-Tuple{WriteVTK.MultiblockFile}"><code>vtk_save</code></a> as usual. In an MPI job, <code>vtk_save</code> will cause each rank to write a serial file and just a single rank (e.g., rank 0) will write the header file.</p><p>This signature is valid for <strong>unstructured grids</strong>. For the case of structured grids, there are small differences detailed <a href="#Parallel-structured-files">further below</a>.</p><p>Positional and keyword arguments in <code>args</code> and <code>kwargs</code> are passed to <code>vtk_grid</code> verbatim. Note that serial filenames are automatically generated from <code>filename</code> and from the process id <code>part</code>.</p><p>The following keyword arguments only apply to parallel VTK file formats.</p><p>Mandatory ones are:</p><ul><li><code>part</code>: current (1-based) part id (typically MPI rank + 1),</li><li><code>nparts</code>: total number of parts (typically the MPI communicator size).</li></ul><p>Optional ones are:</p><ul><li><code>ismain</code>: <code>true</code> if the current part id <code>part</code> is the main (the only one that will write the header file),</li><li><code>ghost_level</code>: ghost level.</li></ul><h2 id="Parallel-structured-files"><a class="docs-heading-anchor" href="#Parallel-structured-files">Parallel structured files</a><a id="Parallel-structured-files-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-structured-files" title="Permalink"></a></h2><p>For structured grids, one needs to specify the portion of the grid associated to each process. This is done via the <code>extents</code> keyword argument, which must be an array containing the data ranges along each dimension associated to each process. For example, for a dataset of global dimensions <span>$15×12×4$</span> distributed across 4 processes, this array may look like the following:</p><pre><code class="language-julia hljs">extents = [
    ( 1:10,  1:5, 1:4),  # process 1
    (10:15,  1:5, 1:4),  # process 2
    ( 1:10, 5:12, 1:4),  # process 3
    (10:15, 5:12, 1:4),  # process 4
]</code></pre><p>In practice, in parallel applications, all processes need to have this information, and the <code>extents</code> argument must be the same for all processes. Also note that the length of the <code>extents</code> array gives the number of processes, and therefore the <code>nparts</code> argument is redundant and not needed for structured grids.</p><p>Finally, note that in the example above the extents for different processes <strong>overlap</strong> (for instance, the ranges <code>1:10</code> and <code>10:15</code> overlap at the index <code>i = 10</code>). This is a requirement of VTK, and without it the full data cannot be visualised in ParaView. For MPI applications, this typically means that ghost data need to be exchanged before writing VTK files.</p><h2 id="Example-1:-Unstructured-files"><a class="docs-heading-anchor" href="#Example-1:-Unstructured-files">Example 1: Unstructured files</a><a id="Example-1:-Unstructured-files-1"></a><a class="docs-heading-anchor-permalink" href="#Example-1:-Unstructured-files" title="Permalink"></a></h2><p>This generates two serial files (typically held by two different processes) and a header file combining them:</p><pre><code class="language-julia hljs">all_data = [
    # Process 1
    (
        points = rand(3, 5),  # 5 points on process 1
        cells = [             # 2 cells  on process 1
            MeshCell(VTKCellTypes.VTK_TRIANGLE, [1, 4, 2]),
            MeshCell(VTKCellTypes.VTK_QUAD, [2, 4, 3, 5]),
        ],
    ),

    # Process 2
    (
        points = rand(3, 4),  # 4 points on process 2
        cells = [             # 1 cell   on process 2
            MeshCell(VTKCellTypes.VTK_QUAD, [1, 2, 3, 4]),
        ]
    ),
]

saved_files = Vector{Vector{String}}(undef, 2)  # files saved by each &quot;process&quot;

for part = 1:2
    data = all_data[part]
    saved_files[part] = pvtk_grid(
            &quot;simulation&quot;, data.points, data.cells;
            part = part, nparts = 2,
        ) do pvtk
        pvtk[&quot;Pressure&quot;] = sum(data.points; dims = 1)
    end
end</code></pre><p>In this example, <code>saved_files</code> lists the files saved by each &quot;process&quot;:</p><pre><code class="language-julia hljs">julia&gt; saved_files
2-element Vector{Vector{String}}:
 [&quot;simulation.pvtu&quot;, &quot;simulation/simulation_1.vtu&quot;]
 [&quot;simulation/simulation_2.vtu&quot;]</code></pre><p>Note that the files containing the actual data (in this case <code>simulation_*.vtu</code>) are stored in a separate <code>simulation</code> directory.</p><h2 id="Example-2:-Structured-files"><a class="docs-heading-anchor" href="#Example-2:-Structured-files">Example 2: Structured files</a><a id="Example-2:-Structured-files-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2:-Structured-files" title="Permalink"></a></h2><p>This generates 4 serial <a href="../../grids/structured/#Image-data">image data</a> files (<code>.vti</code>) and a header file (<code>.pvti</code>) combining them:</p><pre><code class="language-julia hljs"># Global grid
xs_global = range(0, 2; length = 15)
ys_global = range(-1, 1; length = 12)
zs_global = range(0, 1; length = 4)

extents = [
    ( 1:10,  1:5, 1:4),  # process 1
    (10:15,  1:5, 1:4),  # process 2
    ( 1:10, 5:12, 1:4),  # process 3
    (10:15, 5:12, 1:4),  # process 4
]

saved_files = Vector{Vector{String}}(undef, 4)  # files saved by each &quot;process&quot;

for part = 1:4
    is, js, ks = extents[part]  # local indices
    xs, ys, zs = xs_global[is], ys_global[js], zs_global[ks]  # local grid
    saved_files[part] = pvtk_grid(
            &quot;fields&quot;, xs, ys, zs;
            part = part, extents = extents,
        ) do pvtk
        pvtk[&quot;Temperature&quot;] = [x + 2y + 3z for x ∈ xs, y ∈ ys, z ∈ zs]
    end
end</code></pre><p>As in the previous example, <code>saved_files</code> lists the files saved by each &quot;process&quot;:</p><pre><code class="language-julia hljs">julia&gt; saved_files
4-element Vector{Vector{String}}:
 [&quot;fields.pvti&quot;, &quot;fields/fields_1.vti&quot;]
 [&quot;fields/fields_2.vti&quot;]
 [&quot;fields/fields_3.vti&quot;]
 [&quot;fields/fields_4.vti&quot;]</code></pre><h2 id="Acknowledgements"><a class="docs-heading-anchor" href="#Acknowledgements">Acknowledgements</a><a id="Acknowledgements-1"></a><a class="docs-heading-anchor-permalink" href="#Acknowledgements" title="Permalink"></a></h2><p>Thanks to <a href="https://www.francescverdugo.com/">Francesc Verdugo</a> and <a href="https://research.monash.edu/en/persons/alberto-f-martin">Alberto F. Martin</a> for the initial parallel file format implementation, and to <a href="https://lmrs.univ-rouen.fr/fr/persopage/corentin-lothode">Corentin Lothode</a> for the initial work on structured grids.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../paraview_collections/">« ParaView collections</a><a class="docs-footer-nextpage" href="../../tools/surface/">Generating surface plots »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Thursday 4 April 2024 09:37">Thursday 4 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
